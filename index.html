<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>小红书心理学内容生成器</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #fdf6ec;
      --bg-alt: #fff0f5;
      --card-bg: #ffffff;
      --primary: #e8a0a0;
      --primary-strong: #f28b82;
      --primary-soft: rgba(232, 160, 160, 0.16);
      --accent-apricot: #f5c9a0;
      --accent-rose: #f7c6c7;
      --text-main: #5c3d2e;
      --text-sub: #8c6b5b;
      --border: rgba(238, 205, 186, 0.9);
      --radius-lg: 18px;
      --shadow-soft: 0 16px 45px rgba(209, 160, 132, 0.22);
      --font-sans: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "PingFang SC", "Microsoft YaHei", sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: var(--font-sans);
      background:
        radial-gradient(circle at top left, rgba(255, 244, 236, 0.98), transparent 60%),
        radial-gradient(circle at bottom right, rgba(255, 230, 236, 0.9), transparent 55%),
        linear-gradient(135deg, #fdf6ec 0%, #fff0f5 55%, #ffe9dd 100%);
      color: var(--text-main);
      display: flex;
      align-items: stretch;
      justify-content: center;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }

    .app-shell {
      width: 100%;
      max-width: 1180px;
      padding: 28px 20px 40px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 14px;
    }

    .nav-tabs {
      margin-top: 16px;
      display: inline-flex;
      padding: 4px;
      border-radius: 999px;
      background: rgba(255, 248, 243, 0.9);
      border: 1px solid rgba(241, 210, 190, 0.9);
      gap: 4px;
    }

    .nav-tab {
      border-radius: 999px;
      border: none;
      padding: 6px 12px;
      font-size: 12px;
      background: transparent;
      color: #8c6b5b;
      cursor: pointer;
      transition: all 0.15s ease;
      white-space: nowrap;
    }

    .nav-tab.active {
      background: linear-gradient(135deg, #ffe1dd, #f7c6c7);
      color: #5c3d2e;
      box-shadow: 0 6px 16px rgba(221, 178, 153, 0.6);
    }

    .app-title-block {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .app-title-row {
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }

    .logo-dot {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #fff5f6, #e8a0a0);
      box-shadow: 0 0 0 4px rgba(248, 213, 213, 0.9), 0 0 18px rgba(232, 160, 160, 0.8);
    }

    .title-main {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: none;
      color: #5c3d2e;
    }

    .title-sub {
      font-size: 13px;
      color: var(--text-sub);
    }

    .app-badge-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      font-size: 11px;
    }

    .badge-pill {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(241, 200, 176, 0.9);
      background: linear-gradient(135deg, #fff9f4, #ffe9df);
      color: #8c6b5b;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .badge-pill span {
      font-size: 11px;
      letter-spacing: 0.03em;
      color: #b07a60;
    }

    .badge-pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #ffe4e6, #e8a0a0);
    }

    .app-actions {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .app-actions-note {
      font-size: 11px;
      color: #b07a60;
    }

    .app-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.05fr) minmax(0, 1.35fr);
      gap: 18px;
      align-items: flex-start;
    }

    @media (max-width: 900px) {
      .app-shell {
        padding: 18px 14px 26px;
      }

      .app-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .app-layout {
        grid-template-columns: minmax(0, 1fr);
      }

      .app-actions {
        justify-content: flex-start;
      }
    }

    .panel {
      background: var(--card-bg);
      border-radius: 22px;
      padding: 20px 20px 18px;
      box-shadow: 0 14px 40px rgba(221, 178, 153, 0.35);
      border: 1px solid rgba(241, 210, 190, 0.9);
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at top left, rgba(249, 217, 207, 0.6), transparent 55%),
        radial-gradient(circle at bottom right, rgba(252, 228, 236, 0.7), transparent 50%);
      opacity: 0.4;
      pointer-events: none;
    }

    .panel-inner {
      position: relative;
      z-index: 1;
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px;
      gap: 8px;
    }

    .title {
      font-size: 17px;
      font-weight: 600;
      letter-spacing: 0.03em;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--text-main);
    }

    .title-pill {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #fff7f2;
      color: #b36b5e;
      font-weight: 500;
      border: 1px solid rgba(241, 204, 187, 0.9);
    }

    .subtitle {
      font-size: 12px;
      color: var(--text-sub);
      margin-bottom: 14px;
      line-height: 1.7;
    }

    .form-group {
      margin-bottom: 18px;
    }

    label {
      font-size: 12px;
      color: var(--text-sub);
      margin-bottom: 6px;
      display: block;
    }

    .keyword-input {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    input[type="text"] {
      flex: 1;
      padding: 9px 13px;
      border-radius: 999px;
      border: 1px solid rgba(238, 205, 186, 0.95);
      font-size: 13px;
      outline: none;
      transition: all 0.16s ease;
      background: #fffaf5;
      color: var(--text-main);
    }

    input[type="text"]:focus {
      border-color: rgba(232, 160, 160, 0.9);
      box-shadow: 0 0 0 1px rgba(232, 160, 160, 0.4);
      background: #ffffff;
    }

    input::placeholder {
      color: #c2a294;
    }

    button {
      border: none;
      border-radius: 999px;
      background:
        linear-gradient(135deg, #f7c6c7 0%, #e8a0a0 40%, #f5c9a0 100%);
      background-size: 180% 180%;
      color: #5c3d2e;
      padding: 9px 18px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 10px 26px rgba(232, 160, 160, 0.5);
      transition: transform 0.14s ease, box-shadow 0.14s ease, filter 0.14s ease, background-position 0.5s ease;
      white-space: nowrap;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 34px rgba(219, 150, 135, 0.55);
      filter: brightness(1.03);
      background-position: 100% 0;
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 8px 18px rgba(202, 140, 125, 0.5);
    }

    button:disabled {
      opacity: 0.65;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
      filter: grayscale(0.1);
    }

    .hint {
      font-size: 11px;
      color: #b07a60;
      display: flex;
      flex-wrap: wrap;
      gap: 6px 12px;
      align-items: center;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .chip {
      padding: 4px 10px;
      border-radius: 999px;
      background: #fff8f3;
      font-size: 11px;
      color: #8c6b5b;
      cursor: pointer;
      border: 1px solid rgba(238, 205, 186, 0.9);
      transition: all 0.12s ease;
      user-select: none;
    }

    .chip:hover {
      background: #ffefe5;
      border-color: rgba(232, 160, 160, 0.9);
    }

    .chip.primary {
      background: linear-gradient(135deg, #ffe1dd, #f7c6c7);
      color: #5c3d2e;
      border-color: rgba(232, 160, 160, 1);
      box-shadow: 0 0 0 1px rgba(232, 160, 160, 0.4);
    }

    .meta-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: #b07a60;
      margin-top: 6px;
    }

    .badge-soft {
      padding: 3px 10px;
      border-radius: 999px;
      background: #fff8f3;
      color: #b07a60;
      font-size: 11px;
      border: 1px solid rgba(238, 205, 186, 0.9);
    }

    .badge-soft strong {
      color: #8c5c45;
    }

    .results-panel {
      position: relative;
    }

    .results-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }

    .results-meta {
      font-size: 11px;
      color: #b07a60;
    }

    .results-meta strong {
      color: #8c5c45;
    }

    .actions-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .ghost-btn {
      border-radius: 999px;
      border: 1px solid rgba(238, 205, 186, 0.95);
      background: #fff8f3;
      color: #8c6b5b;
      font-size: 11px;
      padding: 6px 10px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: all 0.12s ease;
    }

    .ghost-btn:hover {
      background: #ffefe5;
      border-color: rgba(232, 160, 160, 0.9);
    }

    .posts-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: 540px;
      overflow: auto;
      padding-right: 2px;
    }

    .post-card {
      border-radius: var(--radius-lg);
      padding: 14px 14px 12px;
      background:
        linear-gradient(135deg, #fffdf9, #fff6f2);
      border: 1px solid rgba(241, 210, 190, 0.9);
      position: relative;
      box-shadow: 0 12px 30px rgba(221, 178, 153, 0.55);
    }

    .post-card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(247, 198, 199, 0.3), transparent 45%, rgba(245, 201, 160, 0.25));
      opacity: 0.85;
      mix-blend-mode: soft-light;
      pointer-events: none;
    }

    .post-card > * {
      position: relative;
      z-index: 1;
    }

    .post-index {
      position: absolute;
      top: 10px;
      right: 12px;
      font-size: 10px;
      color: #ae6b5a;
      background: #fff5f0;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(232, 160, 160, 0.8);
    }

    .post-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 8px;
      line-height: 1.5;
      color: #5c3d2e;
    }

    .post-body {
      font-size: 12px;
      color: #7a5542;
      white-space: pre-line;
      line-height: 1.7;
      margin-bottom: 8px;
    }

    .post-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 4px;
    }

    .tag {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #fff0f5;
      color: #ae6b5a;
      border: 1px solid rgba(232, 160, 160, 0.8);
    }

    .post-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 10px;
      color: #b07a60;
      margin-top: 2px;
    }

    .copy-btn {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(238, 205, 186, 0.95);
      background: #fff8f3;
      color: #8c6b5b;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: all 0.12s ease;
    }

    .copy-btn:hover {
      background: #ffefe5;
      border-color: rgba(232, 160, 160, 0.9);
    }

    .empty-state {
      border-radius: 18px;
      background:
        linear-gradient(135deg, #fffdf9, #fff6f3);
      padding: 22px 18px 18px;
      text-align: left;
      color: #8c6b5b;
      font-size: 12px;
      border: 1px dashed rgba(238, 205, 186, 0.95);
    }

    .empty-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
      color: #5c3d2e;
    }

    .empty-list {
      padding-left: 18px;
      margin: 6px 0 8px;
      line-height: 1.6;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 999px;
      background: #fff8f3;
      border: 1px dashed rgba(238, 205, 186, 0.95);
      color: #b07a60;
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #e8a0a0;
    }

    .toast {
      position: fixed;
      left: 50%;
      bottom: 26px;
      transform: translateX(-50%);
      background: #fff8f3;
      color: #5c3d2e;
      font-size: 12px;
      padding: 7px 13px;
      border-radius: 999px;
      box-shadow: 0 18px 40px rgba(221, 178, 153, 0.6);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.16s ease, transform 0.16s ease;
      z-index: 9999;
      display: flex;
      align-items: center;
      gap: 8px;
      border: 1px solid rgba(232, 160, 160, 0.9);
    }

    .toast.show {
      opacity: 1;
      transform: translate(-50%, -4px);
      pointer-events: auto;
    }

    .toast-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #ffe4e6, #e8a0a0);
      box-shadow: 0 0 10px rgba(232, 160, 160, 0.9);
    }

    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: #e5e7eb;
      border-radius: 999px;
    }

    .count-select {
      border-radius: 999px;
      border: 1px solid rgba(238, 205, 186, 0.95);
      background: #fff8f3;
      font-size: 11px;
      padding: 4px 9px;
      color: #8c6b5b;
      outline: none;
    }

    .count-select:focus {
      border-color: rgba(232, 160, 160, 0.9);
      box-shadow: 0 0 0 1px rgba(232, 160, 160, 0.4);
      background: #ffffff;
    }

  </style>
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="app-title-block">
        <div class="app-title-row">
          <div class="logo-dot"></div>
          <div class="title-main">鱼仔的创作灵感库</div>
        </div>
        <div class="title-sub">
          小红书账号「鱼仔的心理树洞」专属 · 身心疗愈 / 情感关系 / 女性成长创作中台
        </div>
        <div class="app-badge-row">
          <div class="badge-pill">
            <div class="badge-pill-dot"></div>
            <span>Story · Empathy · Practice</span>
          </div>
        </div>
        <div class="nav-tabs" id="navTabs">
          <button class="nav-tab active" data-agent="content">内容生产</button>
          <button class="nav-tab" data-agent="radar">爆款雷达</button>
          <button class="nav-tab" data-agent="titles">标题测试</button>
        </div>
      </div>
      <div class="app-actions">
        <div class="app-actions-note">
          API Key 由 Vercel 环境变量配置，安全不泄露
        </div>
      </div>
    </header>

    <main class="app-layout" id="agentContent">
      <!-- Agent 1：内容生产 -->
      <section class="panel agent-panel" data-agent="content">
        <div class="panel-inner">
          <div class="panel-header">
            <div class="title">
              Agent 1 · 内容生产
              <span class="title-pill">小红书心理学笔记生成</span>
            </div>
          </div>
          <p class="subtitle">
            输入一个你想深挖的心理学关键词，我会结合「鱼仔的心理树洞」账号定位，
            生成多条适合直接发布的小红书笔记草稿。
          </p>

          <div class="form-group">
            <label for="content-keyword">
              关键词（必填）
            </label>
            <div class="keyword-input">
              <input
                id="content-keyword"
                type="text"
                spellcheck="false"
                placeholder="例如：原生家庭 / 内耗 / 边界感 / 情绪稳定 / 自我价值感"
              />
            </div>
          </div>

          <div class="form-group">
            <label>风格偏好</label>
            <div class="chip-row" id="content-style-chips">
              <span class="chip primary" data-style="healing_story">疗愈故事</span>
              <span class="chip" data-style="practical">干货实用</span>
              <span class="chip" data-style="emotional">情感共鸣</span>
            </div>
          </div>

          <div class="form-group">
            <label>生成条数</label>
            <div class="meta-row">
              <div class="badge-soft">
                每次生成 <strong id="content-count-label">3</strong> 条
              </div>
              <div style="display:flex;align-items:center;gap:6px;">
                <select id="content-count" class="count-select">
                  <option value="1">1 条（精修）</option>
                  <option value="3" selected>3 条</option>
                  <option value="5">5 条</option>
                </select>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label>猜你现在的创作状态（可选）</label>
            <div class="chip-row" id="content-keyword-chips">
              <span class="chip">灵感很多但不知道从哪条开始写</span>
              <span class="chip">最近有点丧，想写点疗愈向</span>
              <span class="chip">想做一组系列内容</span>
              <span class="chip">手上有咨询案例想改写成故事</span>
            </div>
          </div>

          <button id="content-generate-btn" style="margin-top:4px;">
            生成小红书笔记
          </button>

          <p class="hint" style="margin-top:8px;">
            提示：AI 会先用一小段「思考过程」帮你梳理切入角度，再写正式笔记内容。
          </p>
        </div>
      </section>

      <section class="panel results-panel agent-panel" data-agent="content">
        <div class="panel-inner">
          <div class="results-header-row">
            <div>
              <div class="title" style="font-size:15px;margin-bottom:2px;">
                生成结果 · 小红书笔记
              </div>
              <div class="results-meta" id="content-results-meta">
                等你输入关键词 ✍️
              </div>
            </div>
            <div class="actions-row">
              <button class="ghost-btn" id="content-copy-all">
                复制全部
              </button>
            </div>
          </div>
          <div class="posts-list" id="content-posts-list">
            <div class="empty-state">
              <div class="empty-title">
                先告诉我，你最近最想聊的那个心理学关键词？
              </div>
              <p>
                比如「原生家庭」「情绪稳定」「亲密关系里的边界感」，我会按照「鱼仔的心理树洞」的账号定位，
                帮你拆成多条有故事、有共鸣、又有小练习的小红书笔记。
              </p>
              <ul class="empty-list">
                <li>每条都自带：标题 + 正文结构 + 适配的话题标签</li>
                <li>正文会有明显的段落节奏，让读者容易读、容易收藏和评论</li>
                <li>你可以把喜欢的结果收藏起来，之后按系列慢慢发布</li>
              </ul>
              <div style="display:flex;gap:8px;flex-wrap:wrap;">
                <span class="pill">
                  <span class="pill-dot"></span>
                  有故事
                </span>
                <span class="pill">
                  <span class="pill-dot" style="background:#f5c9a0;"></span>
                  有共鸣
                </span>
                <span class="pill">
                  <span class="pill-dot" style="background:#e8a0a0;"></span>
                  有小练习
                </span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Agent 2：爆款雷达 -->
      <section class="panel agent-panel" data-agent="radar" style="display:none;">
        <div class="panel-inner">
          <div class="panel-header">
            <div class="title">
              Agent 2 · 爆款雷达
              <span class="title-pill">话题热度&用户痛点扫描</span>
            </div>
          </div>
          <p class="subtitle">
            输入一个情绪相关的关键词，我会从平台趋势、用户情绪与内容消费习惯出发，
            帮你拆解这个话题适合的爆款切入角度。
          </p>

          <div class="form-group">
            <label for="radar-keyword">情绪关键词（必填）</label>
            <div class="keyword-input">
              <input
                id="radar-keyword"
                type="text"
                spellcheck="false"
                placeholder="例如：崩溃 / 空心 / 情绪稳定 / 自我怀疑"
              />
            </div>
          </div>

          <div class="form-group">
            <label>你更关心哪一类读者？（可选）</label>
            <div class="chip-row" id="radar-target-chips">
              <span class="chip">职场高压女孩</span>
              <span class="chip">情感关系里很拧巴的人</span>
              <span class="chip">长期焦虑、睡不好的人</span>
              <span class="chip">外表独立但内心很敏感的人</span>
            </div>
          </div>

          <button id="radar-generate-btn">
            扫描爆款切入角度
          </button>
        </div>
      </section>

      <section class="panel results-panel agent-panel" data-agent="radar" style="display:none;">
        <div class="panel-inner">
          <div class="results-header-row">
            <div>
              <div class="title" style="font-size:15px;margin-bottom:2px;">
                分析结果 · 选题方向
              </div>
              <div class="results-meta" id="radar-results-meta">
                等你输入情绪关键词 ✍️
              </div>
            </div>
          </div>
          <div class="posts-list" id="radar-list">
            <div class="empty-state">
              <div class="empty-title">
                不确定这个话题还能怎么写了吗？
              </div>
              <p>
                把你最近反复想到的那个情绪词丢进来，比如「崩溃」「内耗」「失控」，我会帮你看到：
                现在平台上更容易爆的切入角度、用户到底在纠结什么、你可以从哪里讲起。
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- Agent 3：标题测试 -->
      <section class="panel agent-panel" data-agent="titles" style="display:none;">
        <div class="panel-inner">
          <div class="panel-header">
            <div class="title">
              Agent 3 · 标题测试
              <span class="title-pill">多风格标题脑洞机</span>
            </div>
          </div>
          <p class="subtitle">
            输入一个你想写的主题，我会给出多种风格的标题方案（悬念型 / 共鸣型 / 干货型 / 反差型等），
            并解释为什么这个标题有机会爆。
          </p>

          <div class="form-group">
            <label for="titles-topic">主题（必填）</label>
            <div class="keyword-input">
              <input
                id="titles-topic"
                type="text"
                spellcheck="false"
                placeholder="例如：总是在关系里过度付出 / 情绪稳定训练营 / 和原生家庭和解"
              />
            </div>
          </div>

          <button id="titles-generate-btn">
            生成 8 个标题方案
          </button>

          <p class="hint" style="margin-top:8px;">
            提示：你可以把喜欢的标题改一改再用，或者组合不同标题里的关键词。
          </p>
        </div>
      </section>

      <section class="panel results-panel agent-panel" data-agent="titles" style="display:none;">
        <div class="panel-inner">
          <div class="results-header-row">
            <div>
              <div class="title" style="font-size:15px;margin-bottom:2px;">
                测试结果 · 标题候选
              </div>
              <div class="results-meta" id="titles-results-meta">
                先告诉我你想写的主题 ✍️
              </div>
            </div>
          </div>
          <div class="posts-list" id="titles-list">
            <div class="empty-state">
              <div class="empty-title">
                标题起不出来，只能干瞪眼？
              </div>
              <p>
                直接输入你想写的大致方向，比如「长期情绪不稳定的女孩」「总是在关系里委屈自己的人」，我会给你一整排可用标题，
                并告诉你「为什么这个标题可能会爆」。
              </p>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <div class="toast" id="toast">
    <span class="toast-dot"></span>
    <span id="toastText">已复制到剪贴板</span>
  </div>

  <script>
    const toast = document.getElementById('toast');
    const toastText = document.getElementById('toastText');

    function showToast(text) {
      toastText.textContent = text;
      toast.classList.add('show');
      clearTimeout(showToast._timer);
      showToast._timer = setTimeout(() => {
        toast.classList.remove('show');
      }, 2200);
    }

    async function callAgent(agent, payload) {
      const res = await fetch('/api/generate', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ agent, payload })
      });

      if (!res.ok) {
        let message = '请求失败，请稍后再试';
        try {
          const data = await res.json();
          if (data && data.error) message = data.error;
        } catch (e) {}
        throw new Error(message);
      }

      const json = await res.json();
      return json.data;
    }

    function typewriterEffect(element, fullText, speed = 18) {
      element.textContent = '';
      let idx = 0;
      return new Promise(resolve => {
        function step() {
          if (idx >= fullText.length) {
            resolve();
            return;
          }
          element.textContent += fullText[idx];
          idx += 1;
          const ch = fullText[idx - 1];
          const delay = ch === '，' || ch === '。' || ch === '？' || ch === '！' || ch === '\n'
            ? speed * 3
            : speed;
          setTimeout(step, delay);
        }
        step();
      });
    }

    // 顶部导航切换
    const navTabs = document.getElementById('navTabs');
    const agentPanels = document.querySelectorAll('.agent-panel');

    if (navTabs) {
      navTabs.addEventListener('click', (e) => {
        const btn = e.target.closest('.nav-tab');
        if (!btn) return;
        const agent = btn.dataset.agent;
        navTabs.querySelectorAll('.nav-tab').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        agentPanels.forEach(panel => {
          if (panel.dataset.agent === agent) {
            panel.style.display = '';
          } else {
            panel.style.display = 'none';
          }
        });
      });
    }

    // Agent 1：内容生产
    const contentKeywordInput = document.getElementById('content-keyword');
    const contentStyleChips = document.getElementById('content-style-chips');
    const contentCountSelect = document.getElementById('content-count');
    const contentCountLabel = document.getElementById('content-count-label');
    const contentKeywordChips = document.getElementById('content-keyword-chips');
    const contentGenerateBtn = document.getElementById('content-generate-btn');
    const contentResultsMeta = document.getElementById('content-results-meta');
    const contentPostsList = document.getElementById('content-posts-list');
    const contentCopyAllBtn = document.getElementById('content-copy-all');

    let contentFavorites = [];

    function getContentStyle() {
      const active = contentStyleChips?.querySelector('.chip.primary');
      return active ? active.dataset.style || 'healing_story' : 'healing_story';
    }

    if (contentStyleChips) {
      contentStyleChips.addEventListener('click', (e) => {
        const chip = e.target.closest('.chip');
        if (!chip) return;
        contentStyleChips.querySelectorAll('.chip').forEach(c => c.classList.remove('primary'));
        chip.classList.add('primary');
      });
    }

    if (contentCountSelect) {
      contentCountSelect.addEventListener('change', () => {
        contentCountLabel.textContent = contentCountSelect.value;
      });
    }

    if (contentKeywordChips) {
      contentKeywordChips.addEventListener('click', (e) => {
        const chip = e.target.closest('.chip');
        if (!chip) return;
        showToast(chip.textContent.trim());
      });
    }

    function renderContentPosts(data, keyword) {
      const posts = data.posts || [];
      contentPostsList.innerHTML = '';

      posts.forEach((post, index) => {
        const card = document.createElement('article');
        card.className = 'post-card';

        const indexBadge = document.createElement('div');
        indexBadge.className = 'post-index';
        indexBadge.textContent = `NO.${index + 1}`;
        card.appendChild(indexBadge);

        const titleEl = document.createElement('h3');
        titleEl.className = 'post-title';
        titleEl.textContent = post.title || '';
        card.appendChild(titleEl);

        const thinkingEl = document.createElement('div');
        thinkingEl.className = 'post-body';
        thinkingEl.style.fontSize = '11px';
        thinkingEl.style.color = '#b07a60';
        thinkingEl.style.marginBottom = '4px';
        thinkingEl.textContent = '【思考过程】正在整理切入角度…';
        card.appendChild(thinkingEl);

        const bodyEl = document.createElement('div');
        bodyEl.className = 'post-body';
        bodyEl.textContent = '';
        card.appendChild(bodyEl);

        const tagsWrap = document.createElement('div');
        tagsWrap.className = 'post-tags';
        (post.tags || []).forEach(t => {
          const tagEl = document.createElement('span');
          tagEl.className = 'tag';
          tagEl.textContent = t;
          tagsWrap.appendChild(tagEl);
        });
        card.appendChild(tagsWrap);

        const footer = document.createElement('div');
        footer.className = 'post-footer';

        const meta = document.createElement('span');
        meta.textContent = {
          healing_story: '疗愈故事向',
          practical: '干货实用向',
          emotional: '情感共鸣向'
        }[post.style] || '综合向';

        const actions = document.createElement('div');
        actions.style.display = 'flex';
        actions.style.gap = '6px';

        const favBtn = document.createElement('button');
        favBtn.className = 'copy-btn';
        favBtn.textContent = '收藏';

        favBtn.addEventListener('click', () => {
          const key = post.title + '|' + (post.body || '');
          const exists = contentFavorites.includes(key);
          if (exists) {
            contentFavorites = contentFavorites.filter(k => k !== key);
            favBtn.textContent = '收藏';
            showToast('已从收藏中移除');
          } else {
            contentFavorites.push(key);
            favBtn.textContent = '已收藏';
            showToast('已收藏这条灵感');
          }
        });

        const copyBtn = document.createElement('button');
        copyBtn.className = 'copy-btn';
        copyBtn.textContent = '复制';
        copyBtn.addEventListener('click', () => {
          const tags = (post.tags || []).join(' ');
          const full = `【标题】\n${post.title || ''}\n\n【正文】\n${post.body || ''}\n\n【话题标签】\n${tags}`;
          navigator.clipboard.writeText(full).then(() => {
            showToast('当前文案已复制，可以直接粘贴到小红书～');
          });
        });

        actions.appendChild(favBtn);
        actions.appendChild(copyBtn);

        footer.appendChild(meta);
        footer.appendChild(actions);
        card.appendChild(footer);

        contentPostsList.appendChild(card);

        const thinking = post.thinking || '';
        const body = post.body || '';
        typewriterEffect(thinkingEl, `【思考过程】\n${thinking}`).then(() => {
          return typewriterEffect(bodyEl, body);
        });
      });

      contentResultsMeta.innerHTML =
        `已根据 <strong>「${keyword}」</strong> 生成 <strong>${posts.length}</strong> 条小红书笔记草稿，可按需微调后发布。`;
    }

    if (contentGenerateBtn) {
      contentGenerateBtn.addEventListener('click', async () => {
        const raw = contentKeywordInput.value.trim();
        if (!raw) {
          contentKeywordInput.focus();
          showToast('先输入一个心理学关键词哦');
          return;
        }

        const keyword = raw.replace(/[#\s]/g, '');
        const style = getContentStyle();
        const count = parseInt(contentCountSelect.value, 10) || 3;

        contentGenerateBtn.disabled = true;
        contentGenerateBtn.textContent = '生成中…';
        contentResultsMeta.textContent = 'AI 正在根据账号定位思考结构和切入角度…';

        try {
          const data = await callAgent('content', { keyword, style, count });
          renderContentPosts(data, keyword);
        } catch (err) {
          console.error(err);
          showToast(err.message || '生成失败，请稍后再试');
        } finally {
          contentGenerateBtn.disabled = false;
          contentGenerateBtn.textContent = '生成小红书笔记';
        }
      });

      contentKeywordInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          contentGenerateBtn.click();
        }
      });
    }

    if (contentCopyAllBtn) {
      contentCopyAllBtn.addEventListener('click', () => {
        const cards = contentPostsList.querySelectorAll('.post-card');
        if (!cards.length) {
          showToast('还没有内容可复制，先生成一批文案吧');
          return;
        }

        const blocks = [];
        cards.forEach((card, index) => {
          const title = card.querySelector('.post-title')?.textContent || '';
          const body = Array.from(card.querySelectorAll('.post-body'))[1]?.textContent || '';
          const tags = Array.from(card.querySelectorAll('.tag')).map(t => t.textContent).join(' ');

          blocks.push(
            `第${index + 1}条\n\n【标题】\n${title}\n\n【正文】\n${body}\n\n【话题标签】\n${tags}`
          );
        });

        const text = blocks.join('\n\n------------------------\n\n');

        navigator.clipboard.writeText(text).then(() => {
          showToast('本页所有文案已复制，去小红书排版就行啦');
        });
      });
    }

    // Agent 2：爆款雷达
    const radarKeywordInput = document.getElementById('radar-keyword');
    const radarTargetChips = document.getElementById('radar-target-chips');
    const radarGenerateBtn = document.getElementById('radar-generate-btn');
    const radarResultsMeta = document.getElementById('radar-results-meta');
    const radarList = document.getElementById('radar-list');

    if (radarTargetChips) {
      radarTargetChips.addEventListener('click', (e) => {
        const chip = e.target.closest('.chip');
        if (!chip) return;
        radarTargetChips.querySelectorAll('.chip').forEach(c => c.classList.remove('primary'));
        chip.classList.add('primary');
      });
    }

    function renderRadarResults(data, keyword) {
      radarList.innerHTML = '';
      const ideas = data.ideas || [];

      ideas.forEach((idea, index) => {
        const card = document.createElement('article');
        card.className = 'post-card';

        const indexBadge = document.createElement('div');
        indexBadge.className = 'post-index';
        indexBadge.textContent = `方向 ${index + 1}`;
        card.appendChild(indexBadge);

        const titleEl = document.createElement('h3');
        titleEl.className = 'post-title';
        titleEl.textContent = idea.angleTitle || '';
        card.appendChild(titleEl);

        const bodyEl = document.createElement('div');
        bodyEl.className = 'post-body';
        bodyEl.textContent = idea.summary || '';
        card.appendChild(bodyEl);

        const tagsWrap = document.createElement('div');
        tagsWrap.className = 'post-tags';
        (idea.painPoints || []).forEach(t => {
          const tagEl = document.createElement('span');
          tagEl.className = 'tag';
          tagEl.textContent = t;
          tagsWrap.appendChild(tagEl);
        });
        card.appendChild(tagsWrap);

        const footer = document.createElement('div');
        footer.className = 'post-footer';

        const meta = document.createElement('span');
        meta.textContent = '建议写法';

        const suggestBtn = document.createElement('button');
        suggestBtn.className = 'copy-btn';
        suggestBtn.textContent = '复制选题说明';
        suggestBtn.addEventListener('click', () => {
          const suggestions = (idea.suggestions || []).join('\n- ');
          const full = `【选题方向】\n${idea.angleTitle || ''}\n\n【适合写】\n${idea.summary || ''}\n\n【用户痛点】\n- ${(idea.painPoints || []).join('\n- ')}\n\n【写作建议】\n- ${suggestions}`;
          navigator.clipboard.writeText(full).then(() => {
            showToast('已复制这个选题方向，可以丢进内容生产 Agent 继续写～');
          });
        });

        footer.appendChild(meta);
        footer.appendChild(suggestBtn);
        card.appendChild(footer);

        radarList.appendChild(card);
      });

      radarResultsMeta.innerHTML =
        `已围绕情绪关键词 <strong>「${keyword}」</strong> 生成 <strong>${ideas.length}</strong> 个选题方向，可直接作为系列内容的骨架。`;
    }

    if (radarGenerateBtn) {
      radarGenerateBtn.addEventListener('click', async () => {
        const raw = radarKeywordInput.value.trim();
        if (!raw) {
          radarKeywordInput.focus();
          showToast('先输入一个情绪关键词哦');
          return;
        }

        const keyword = raw.replace(/[#\s]/g, '');
        radarGenerateBtn.disabled = true;
        radarGenerateBtn.textContent = '分析中…';
        radarResultsMeta.textContent = 'AI 正在扫描这个话题的痛点和高频切入角度…';

        try {
          const data = await callAgent('radar', { keyword });
          renderRadarResults(data, keyword);
        } catch (err) {
          console.error(err);
          showToast(err.message || '分析失败，请稍后再试');
        } finally {
          radarGenerateBtn.disabled = false;
          radarGenerateBtn.textContent = '扫描爆款切入角度';
        }
      });

      radarKeywordInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          radarGenerateBtn.click();
        }
      });
    }

    // Agent 3：标题测试
    const titlesTopicInput = document.getElementById('titles-topic');
    const titlesGenerateBtn = document.getElementById('titles-generate-btn');
    const titlesResultsMeta = document.getElementById('titles-results-meta');
    const titlesList = document.getElementById('titles-list');

    function renderTitlesResults(data, topic) {
      titlesList.innerHTML = '';
      const titles = data.titles || [];

      titles.forEach((item, index) => {
        const card = document.createElement('article');
        card.className = 'post-card';

        const indexBadge = document.createElement('div');
        indexBadge.className = 'post-index';
        indexBadge.textContent = `方案 ${index + 1}`;
        card.appendChild(indexBadge);

        const titleEl = document.createElement('h3');
        titleEl.className = 'post-title';
        titleEl.textContent = item.title || '';
        card.appendChild(titleEl);

        const bodyEl = document.createElement('div');
        bodyEl.className = 'post-body';
        bodyEl.textContent = item.why || '';
        card.appendChild(bodyEl);

        const footer = document.createElement('div');
        footer.className = 'post-footer';

        const styleMap = {
          suspense: '悬念型',
          empathy: '共鸣型',
          practical: '干货型',
          contrast: '反差型',
          curiosity: '好奇心型',
          list: '清单型',
          story: '故事型',
          other: '混合型'
        };

        const meta = document.createElement('span');
        meta.textContent = styleMap[item.style] || '标题方案';

        const copyBtn = document.createElement('button');
        copyBtn.className = 'copy-btn';
        copyBtn.textContent = '复制标题';
        copyBtn.addEventListener('click', () => {
          navigator.clipboard.writeText(item.title || '').then(() => {
            showToast('标题已复制，可以直接用在封面或笔记标题里');
          });
        });

        footer.appendChild(meta);
        footer.appendChild(copyBtn);
        card.appendChild(footer);

        titlesList.appendChild(card);
      });

      titlesResultsMeta.innerHTML =
        `已围绕主题 <strong>「${topic}」</strong> 生成 <strong>${titles.length}</strong> 个不同风格的标题，并附上爆款逻辑说明。`;
    }

    if (titlesGenerateBtn) {
      titlesGenerateBtn.addEventListener('click', async () => {
        const raw = titlesTopicInput.value.trim();
        if (!raw) {
          titlesTopicInput.focus();
          showToast('先输入一个主题哦');
          return;
        }

        const topic = raw;
        titlesGenerateBtn.disabled = true;
        titlesGenerateBtn.textContent = '生成中…';
        titlesResultsMeta.textContent = 'AI 正在为这个主题拆分不同风格的标题…';

        try {
          const data = await callAgent('titles', { topic });
          renderTitlesResults(data, topic);
        } catch (err) {
          console.error(err);
          showToast(err.message || '生成失败，请稍后再试');
        } finally {
          titlesGenerateBtn.disabled = false;
          titlesGenerateBtn.textContent = '生成 8 个标题方案';
        }
      });

      titlesTopicInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          titlesGenerateBtn.click();
        }
      });
    }
  </script>
</body>
</html>

